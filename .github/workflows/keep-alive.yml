name: Keep Streamlit App Alive

on:
  schedule:
    - cron: '30 5 * * 1-5'
  workflow_dispatch:

jobs:
  ping-app:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Streamlit App
        run: |
          echo "ðŸš€ Streamlit Keep-Alive"
          echo "â° $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo ""
          
          # Ping 1
          echo "ðŸ“¡ Ping 1: Wake up..."
          curl -sL --max-time 180 "${{ secrets.STREAMLIT_APP_URL }}?health=check" || true
          echo ""
          echo "Done."
          
          # Wait
          echo ""
          echo "â³ Waiting 10 seconds..."
          sleep 10
          
          # Ping 2
          echo ""
          echo "ðŸ“¡ Ping 2: Verify..."
          RESULT=$(curl -sL --max-time 30 "${{ secrets.STREAMLIT_APP_URL }}?health=check" || true)
          echo "Response: $RESULT"
          
          # Check
          echo ""
          if [ "$RESULT" = "OK" ]; then
            echo "âœ… SUCCESS!"
          else
            echo "âš ï¸ Response was: $RESULT"
          fi
          
      - name: Summary
        if: always()
        run: |
          echo "## ðŸŒŸ Keep-Alive Report" >> $GITHUB_STEP_SUMMARY
          echo "**Time:** $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Check logs for details." >> $GITHUB_STEP_SUMMARY
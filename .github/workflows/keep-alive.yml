name: Debug URL Secret

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
      - name: Check URL Format
        run: |
          APP_URL="${{ secrets.STREAMLIT_APP_URL }}"
          
          echo "ğŸ” URL DIAGNOSTIC"
          echo "================="
          echo ""
          
          # DÅ‚ugoÅ›Ä‡
          echo "Length: ${#APP_URL} characters"
          
          # Czy pusty
          if [ -z "$APP_URL" ]; then
            echo "âŒ URL is EMPTY!"
            exit 1
          fi
          
          # PokaÅ¼ pierwszy i ostatni znak (bezpiecznie)
          echo "First char: ${APP_URL:0:1}"
          echo "Last char: ${APP_URL: -1}"
          
          # SprawdÅº prefix
          if [[ "$APP_URL" == https://* ]]; then
            echo "âœ… Starts with https://"
          elif [[ "$APP_URL" == http://* ]]; then
            echo "âš ï¸ Starts with http:// (should be https://)"
          else
            echo "âŒ Does NOT start with http:// or https://"
            echo "First 10 chars: ${APP_URL:0:10}"
          fi
          
          # SprawdÅº czy zawiera streamlit.app
          if [[ "$APP_URL" == *".streamlit.app"* ]]; then
            echo "âœ… Contains .streamlit.app"
          else
            echo "âš ï¸ Does NOT contain .streamlit.app"
          fi
          
          # SprawdÅº nielegalne znaki
          if [[ "$APP_URL" == *" "* ]]; then
            echo "âŒ Contains SPACES!"
          fi
          
          if [[ "$APP_URL" == *$'\n'* ]]; then
            echo "âŒ Contains NEWLINE!"
          fi
          
          if [[ "$APP_URL" == *$'\r'* ]]; then
            echo "âŒ Contains CARRIAGE RETURN!"
          fi
          
          # WyodrÄ™bnij domenÄ™
          DOMAIN=$(echo "$APP_URL" | sed -e 's|https://||' -e 's|http://||' -e 's|/.*||')
          echo ""
          echo "Extracted domain: $DOMAIN"
          
          # Test DNS
          echo ""
          echo "ğŸŒ DNS Test:"
          nslookup "$DOMAIN" 2>&1 | head -10
          
          # Test curl
          echo ""
          echo "ğŸŒ Simple curl test:"
          curl -sL -o /dev/null -w "HTTP: %{http_code}\n" --max-time 30 "$APP_URL" || echo "Curl failed with exit code: $?"